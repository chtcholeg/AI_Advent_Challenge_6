# Различия между Day 5 и Day 6

## Краткое описание

Day 6 добавляет функционал копирования сообщений в буфер обмена. Пользователи теперь могут копировать как отдельные сообщения, так и всю историю диалога целиком.

## Новые возможности

### 1. Копирование отдельных сообщений
- Каждое сообщение теперь имеет иконку копирования в правом нижнем углу
- При нажатии на иконку содержимое сообщения копируется в буфер обмена
- Работает для сообщений пользователя, AI и системных сообщений

### 2. Копирование всей истории диалога
- В верхней панели приложения (TopAppBar) добавлена новая кнопка с иконкой копирования
- При нажатии копируется вся история диалога в формате:
  ```
  User: [сообщение пользователя]

  AI: [ответ AI]

  User: [следующее сообщение]
  ...
  ```
- Системные сообщения исключаются из копирования
- Кнопка активна только когда есть сообщения в чате

## Технические изменения

### Новые файлы

1. **ClipboardManager.kt (commonMain)**
   - Expect/Actual архитектура для работы с буфером обмена
   - Единый интерфейс для всех платформ

2. **ClipboardManager.android.kt**
   - Реализация для Android через `android.content.ClipboardManager`
   - Использует Koin для получения Context

3. **ClipboardManager.desktop.kt**
   - Реализация для Desktop через `java.awt.Toolkit`
   - Использует `StringSelection` для помещения текста в буфер

4. **ClipboardManager.wasmJs.kt**
   - Реализация для Web через `navigator.clipboard.writeText()`
   - Использует современный Web API

### Измененные файлы

1. **ChatIntent.kt**
   - Добавлены новые интенты:
     - `CopyMessage(messageId: String)` - копирование одного сообщения
     - `CopyAllMessages` - копирование всей истории

2. **MessageItem.kt**
   - Добавлен параметр `onCopyMessage: (String) -> Unit`
   - Добавлена кнопка копирования в UI (IconButton с иконкой ContentCopy)
   - Кнопка расположена в Row вместе с временной меткой
   - Импортированы необходимые иконки и компоненты

3. **MessageList.kt**
   - Добавлен параметр `onCopyMessage: (String) -> Unit`
   - Callback передается в каждый `MessageItem`

4. **ChatScreen.kt**
   - Импортирована иконка `Icons.Default.ContentCopy`
   - Добавлен IconButton для копирования всей истории в TopAppBar
   - Кнопка размещена между Settings и Delete
   - В MessageList передается callback для копирования отдельных сообщений

5. **ChatStore.kt**
   - Импортирован `ClipboardManager`
   - Добавлена обработка новых интентов в метод `dispatch()`
   - Добавлен метод `copyMessage(messageId: String)` - находит сообщение по ID и копирует его содержимое
   - Добавлен метод `copyAllMessages()` - форматирует и копирует всю историю диалога

## Архитектурные решения

### Expect/Actual для многоплатформенности
Использование expect/actual позволяет:
- Иметь единый интерфейс для всех платформ
- Использовать нативные API каждой платформы
- Избежать дублирования кода в бизнес-логике

### MVI паттерн
Функционал копирования следует существующему MVI паттерну:
- Intent → Store → Action → State
- Чистая архитектура без прямого взаимодействия UI с системными API
- Вся логика сосредоточена в Store

### UI/UX решения
- Иконка копирования в каждом сообщении не перегружает интерфейс (размер 16dp)
- Цвет иконки соответствует цветовой схеме сообщения
- Кнопка копирования всей истории логично размещена в TopAppBar рядом с другими действиями над чатом

## Преимущества изменений

1. **Удобство**: пользователи могут легко копировать ответы AI для использования в других приложениях
2. **Гибкость**: возможность копировать как отдельные сообщения, так и всю историю
3. **Кроссплатформенность**: работает одинаково на Android, Desktop и Web
4. **Расширяемость**: легко добавить дополнительные форматы экспорта в будущем

## Совместимость

Все изменения обратно совместимы и не ломают существующий функционал. Новая функциональность добавлена без изменения существующих API.
